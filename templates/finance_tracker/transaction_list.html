<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>家計簿</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    th:nth-child(1), td:nth-child(1) {
      width: 90px;
      white-space: nowrap;
    }
    th:nth-child(3), td:nth-child(3) {
      width: 350px;
      word-break: break-word;
    }
    th:nth-child(7), td:nth-child(7) {
      width: 110px;
      white-space: nowrap;
    }
  </style>
</head>
<body class="container py-4">
  <nav class="mb-3 d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <a href="{% url 'transaction_list' %}" class="navbar-brand text-dark text-decoration-none fs-3">家計簿</a>
      {% if user.is_authenticated %}
        <span class="text-secondary">{{ user.username }} でログイン中</span>
      {% endif %}
    </div>
    <div class="d-flex align-items-center gap-3">
      {% if user.is_authenticated %}
        <a href="{% url 'category_list' %}" class="btn btn-outline-secondary btn-sm">カテゴリ管理</a>
        <a href="{% url 'add_transaction' %}" class="btn btn-primary btn-sm">新規登録</a>
        <a href="{% url 'logout' %}">ログアウト</a>
      {% else %}
        <a href="{% url 'login' %}">ログイン</a>
      {% endif %}
    </div>
  </nav>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>日付</th>
        <th>カテゴリ</th>
        <th>詳細</th>
        <th>入金額</th>
        <th>出金額</th>
        <th>残高</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for t in transactions %}
        <tr>
          <td>{{ t.date|date:"Y年m月d日" }}</td>
          <td>
            {% if t.category %}
                {{ t.category.name }}
            {% else %}
                -
            {% endif %}
          </td>

          <td>{{ t.description }}</td>
          <td class="text-end">{% if t.type == 'income' %}{{ t.amount|floatformat:"-0" }}{% else %}-{% endif %}</td>
          <td class="text-end">{% if t.type == 'expense' %}{{ t.amount|floatformat:"-0" }}{% else %}-{% endif %}</td>
          <td class="text-end">{{ t.balance|floatformat:"-0" }}</td>
          <td>
            <a href="{% url 'edit_transaction' t.id %}" class="btn btn-sm btn-outline-primary">編集</a>
            <a href="{% url 'delete_transaction' t.id %}" class="btn btn-sm btn-outline-danger">削除</a>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="7" class="text-center">データがありません</td></tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
